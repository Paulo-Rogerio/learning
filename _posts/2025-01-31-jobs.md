---
layout: post
collection: kubernetes
permalink: /kubernetes/jobs
title:  "Kubernetes Jobs"
author: Paulo RogÃ©rio
date:   2025-01-31 15:00:13 -0300
categories: [kubernetes]
published: true
---

## ðŸš€ Kubernetes Jobs

- [1) Batch Jobs](#1-batch-jobs)
- [2) Jobs MÃ£o na Massa](#2-jobs-mÃ£o-na-massa)

#### 1) Batch Jobs

A finalidade Batch Jobs Ã© ***( Executa 1x sÃ³ )***.

Seu fluxo acontece da seguinte forma: 

**Job => Executa um Pod => Durante a execuÃ§Ã£o seu status e Running => ApÃ³s finalizado transita para Completed**

Se eu precisar executar isso todo os dias?

Deve-se definir um CronJob, entÃ£o ele criarÃ¡ o Job que criarÃ¡ o Pod ( Running ) e apÃ³s finalizado transita para Completed. 


#### 2) Jobs MÃ£o na Massa

Listar todos os Jobs...

```bash
âžœ  kind git:(main) k get job -A
NAMESPACE       NAME                             STATUS     COMPLETIONS   DURATION   AGE
ingress-nginx   ingress-nginx-admission-create   Complete   1/1           21s        17m
ingress-nginx   ingress-nginx-admission-patch    Complete   1/1           21s        17m
```

Cronjob e Jobs sÃ£o recursos **namespaced**, isso quer dizer que podem rodar a nivel de namespace.

```bash
âžœ  kind git:(main) k api-resources | grep jobs
cronjobs                            cj           batch/v1                          true         CronJob
jobs                                             batch/v1                          true         Job
```

Buscando Doc...

```bash
âžœ  kind git:(main) k explain 
âžœ  kind git:(main) k explain jobs.spec
âžœ  kind git:(main) k explain jobs.spec.template
âžœ  kind git:(main) k explain jobs.spec.template.spec.restartPolicy
âžœ  kind git:(main) k explain jobs.spec.ttlSecondsAfterFinished
```

Gerar Manifesto ...

```bash
âžœ  kind git:(main) k neat <<< $(k create job bash-script --image=prgs/cronjob:exemple --dry-run=client -o yaml)
```

```yaml
apiVersion: batch/v1
kind: Job
metadata:
  name: bash-script
spec:
  template:
    metadata:
    spec:
      containers:
      - image: prgs/cronjob:exemple
        name: bash-script
      restartPolicy: "OnFailure"
  ttlSecondsAfterFinished: 0
```

Job Ã© imultÃ¡vel, uma vez criado nao consigo aplicar o manifesto para sobrepor seu conteudo. E necessÃ¡rio deletar o conteudo antigo.

Para monitorar um job, abra um novo terminal...

```bash
âžœ  kind k get job -w
NAME          STATUS    COMPLETIONS   DURATION   AGE
bash-script   Running   0/1                      0s
bash-script   Running   0/1           0s         0s
bash-script   Running   0/1           4s         4s
bash-script   Complete   1/1           4s         4s
bash-script   Complete   1/1           4s         4s
bash-script   Complete   1/1           4s         4s
```

Execute 
```bash
âžœ  kind git:(main) cat <<EOF | kaf -
apiVersion: batch/v1
kind: Job
metadata:
  name: bash-script
spec:
  template:
    metadata:
    spec:
      containers:
      - image: prgs/cronjob:exemple
        name: bash-script
      restartPolicy: "OnFailure"
  ttlSecondsAfterFinished: 0
EOF
job.batch/bash-script created
```
